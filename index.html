<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Accademia delle Lingue - Piattaforma Trinity</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #1e3a5f; --primary-dark: #152a45; --secondary: #8b0000;
            --success: #276749; --error: #c53030;
            --bg-primary: #f5f5f0; --bg-card: #ffffff; --border: #d4d4c8;
            --text-primary: #2c3e50; --text-secondary: #5a6c7d;
            --trinity-red: #dc2626; --trinity-blue: #1e3a5f;
            --level-a1: #276749; --level-a2: #2563eb; --level-b1: #c9a227;
            --level-b2: #dc2626; --level-c1: #6b21a8; --level-c2: #0f172a;
        }
        body { font-family: 'Georgia', 'Times New Roman', serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }

        /* Login Section */
        .login-section { min-height: 100vh; display: none; align-items: center; justify-content: center; background: var(--bg-primary); padding: 20px 10px; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
        .login-section.active { display: flex; }
        .login-container { width: 100%; max-width: 320px; background: var(--bg-card); border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .login-header { background: var(--primary); padding: 16px 12px; text-align: center; color: white; border-bottom: 2px solid var(--secondary); }
        .login-header h1 { font-size: 1rem; font-weight: normal; letter-spacing: 0.5px; margin-bottom: 2px; }
        .login-header p { font-size: 0.7rem; opacity: 0.9; margin: 0; }
        .login-body { padding: 16px; }
        .login-footer { padding: 10px; text-align: center; border-top: 1px solid var(--border); background: var(--bg-primary); }
        .login-footer p { font-size: 0.65rem; color: var(--text-secondary); margin: 0; }
        .form-group { margin-bottom: 10px; }
        .form-label { display: block; font-size: 0.7rem; font-weight: 600; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.3px; }
        .form-input { width: 100%; padding: 8px 10px; border: 1px solid var(--border); font-size: 0.85rem; font-family: inherit; background: #fafafa; }
        .form-input:focus { outline: none; border-color: var(--primary); background: white; }
        .btn { width: 100%; padding: 10px; background: var(--primary); color: white; border: none; font-size: 0.8rem; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 0.3px; transition: background 0.2s; margin-top: 4px; }
        .btn:hover { background: var(--primary-dark); }
        .alert { padding: 8px 10px; margin-bottom: 10px; font-size: 0.75rem; border-left: 3px solid; display: none; }
        .alert-error { background: #fed7d7; color: var(--error); border-left-color: var(--error); }
        .alert-success { background: #c6f6d5; color: var(--success); border-left-color: var(--success); }
        .signup-link { margin-top: 12px; text-align: center; }
        .signup-link a { color: var(--trinity-blue); text-decoration: none; font-weight: 600; font-size: 0.75rem; }
        .signup-link a:hover { text-decoration: underline; }

        /* Dashboard */
        .dashboard { display: none; min-height: 100vh; flex-direction: column; }
        .top-nav { background: var(--trinity-blue); color: white; padding: 0 24px; height: 64px; display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid var(--trinity-red); flex-shrink: 0; }
        .main-container { display: flex; flex: 1; height: calc(100vh - 64px); overflow: hidden; }
        .sidebar { width: 300px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 24px 0; box-shadow: 2px 0 4px rgba(0,0,0,0.05); overflow-y: auto; flex-shrink: 0; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; margin: 0 12px 4px 12px; cursor: pointer; color: var(--text-secondary); border-left: 3px solid transparent; transition: all 0.2s; font-size: 0.9rem; text-decoration: none; }
        .nav-item:hover { background: var(--bg-primary); color: var(--text-primary); border-left-color: var(--border); }
        .nav-item.active { background: var(--bg-primary); color: var(--trinity-blue); border-left-color: var(--trinity-red); font-weight: 600; }
        .nav-level { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; padding: 2px 6px; margin-left: auto; font-weight: bold; }
        .level-a1 { background: var(--level-a1); color: white; }
        .level-a2 { background: var(--level-a2); color: white; }
        .level-b1 { background: var(--level-b1); color: #000; }
        .level-b2 { background: var(--level-b2); color: white; }
        .level-c1 { background: var(--level-c1); color: white; }
        .level-c2 { background: var(--level-c2); color: white; }
        .exam-badge { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.5px; padding: 2px 6px; margin-left: 4px; background: var(--trinity-red); color: white; font-weight: bold; }
        .content { flex: 1; background: var(--bg-primary); overflow: hidden; display: flex; flex-direction: column; }
        .iframe-container { flex: 1; width: 100%; height: 100%; background: white; }
        .content-iframe { width: 100%; height: 100%; border: none; background: white; }
        .section { display: none; flex: 1; flex-direction: column; height: 100%; overflow: auto; padding: 32px; }
        .section.active { display: flex; }
        .card { background: var(--bg-card); box-shadow: 0 2px 4px rgba(0,0,0,0.08); border: 1px solid var(--border); margin-bottom: 24px; }
        .card-header { padding: 20px 24px; border-bottom: 2px solid var(--border); font-weight: 600; color: var(--trinity-blue); text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.95rem; }
        .card-body { padding: 24px; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
        .game-card { background: var(--bg-card); overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.08); border: 1px solid var(--border); cursor: pointer; transition: all 0.3s; position: relative; text-decoration: none; display: block; color: inherit; }
        .game-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.12); border-color: var(--trinity-blue); }
        .game-level-badge { position: absolute; top: 0; right: 0; padding: 6px 12px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .game-image { height: 160px; display: flex; align-items: center; justify-content: center; font-size: 3.5rem; border-bottom: 3px solid; }
        .bg-a1 { background: linear-gradient(135deg, var(--level-a1) 0%, #1e5c3e 100%); border-color: var(--level-a1); color: white; }
        .bg-a2 { background: linear-gradient(135deg, var(--level-a2) 0%, #1e40af 100%); border-color: var(--level-a2); color: white; }
        .bg-b1 { background: linear-gradient(135deg, var(--level-b1) 0%, #a88c1c 100%); border-color: var(--level-b1); color: #000; }
        .bg-b2 { background: linear-gradient(135deg, var(--level-b2) 0%, #b91c1c 100%); border-color: var(--level-b2); color: white; }
        .bg-c1 { background: linear-gradient(135deg, var(--level-c1) 0%, #4c1d95 100%); border-color: var(--level-c1); color: white; }
        .bg-c2 { background: linear-gradient(135deg, var(--level-c2) 0%, #1e293b 100%); border-color: var(--level-c2); color: white; }
        .game-content { padding: 20px; }
        .game-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: var(--trinity-blue); }
        .game-desc { color: var(--text-secondary); font-size: 0.9rem; font-style: italic; }
        .exam-info { margin-top: 12px; padding: 8px 12px; background: #fef2f2; border-left: 3px solid var(--trinity-red); font-size: 0.8rem; color: var(--text-secondary); }
        .breadcrumbs { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 12px 24px; font-size: 0.85rem; color: var(--text-secondary); margin: -32px -32px 24px -32px; flex-shrink: 0; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); padding: 24px; text-align: center; border-left: 4px solid var(--trinity-red); }
        .stat-label { color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .stat-value { font-size: 2.5rem; font-weight: bold; color: var(--trinity-blue); font-family: 'Times New Roman', serif; }
        .section-title { font-size: 1.75rem; color: var(--trinity-blue); font-weight: normal; margin-bottom: 8px; border-bottom: 2px solid var(--trinity-red); padding-bottom: 12px; }
        .section-subtitle { color: var(--text-secondary); font-style: italic; margin-bottom: 24px; }
        .level-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 32px; }
        .level-card { background: var(--bg-card); border: 2px solid var(--border); padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .level-card:hover, .level-card.active { border-color: var(--trinity-blue); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .level-card.active { background: var(--bg-primary); }
        .level-icon { font-size: 2.5rem; margin-bottom: 12px; }
        .menu-category { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin: 16px 12px 8px 12px; padding-left: 12px; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 4px; }
        .exam-type-tabs { display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid var(--border); }
        .exam-tab { padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-family: inherit; font-size: 0.9rem; font-weight: 600; color: var(--text-secondary); transition: all 0.3s; }
        .exam-tab:hover { color: var(--trinity-blue); }
        .exam-tab.active { color: var(--trinity-blue); border-bottom-color: var(--trinity-red); }
        .status-badge { display: inline-block; padding: 4px 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-completed { background: var(--success); color: white; }
        .status-pending { background: var(--trinity-blue); color: white; }
        @media (max-width: 1024px) { .sidebar { width: 260px; } }
        @media (max-width: 768px) { .sidebar { display: none; } .games-grid { grid-template-columns: 1fr; } .level-selector { grid-template-columns: repeat(2, 1fr); } }
    </style>
<base target="_blank">
<base target="_blank">
</head>
<body>

<!-- LOGIN SECTION -->
<div id="loginSection" class="login-section active">
    <div class="login-container">
        <div class="login-header">
            <h1>Accademia delle Lingue</h1>
            <p>Piattaforma Trinity College London</p>
        </div>
        <div class="login-body">
            <div id="alertBox" class="alert alert-error"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" placeholder="nome@email.it" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn">Accedi</button>
            </form>
            <div class="signup-link">
                <p>Non hai un account?<br><a href="login.html">Richiedi accesso ‚Üí</a></p>
            </div>
        </div>
        <div class="login-footer">
            <p>¬© 2024 Accademia delle Lingue</p>
        </div>
    </div>
</div>

<!-- STUDENT DASHBOARD -->
<div id="dashboard" class="dashboard">
    <nav class="top-nav">
        <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:1.5rem;">üá¨üáß</span>
            <div>
                <div style="font-weight:600; letter-spacing: 0.5px;">TRINITY COLLEGE LONDON</div>
                <div style="font-size:0.7rem; opacity:0.8; font-style:italic;">GESE & ISE - English Language Certification</div>
            </div>
        </div>
        <div style="display:flex;align-items:center;gap:20px;">
            <div style="text-align:right;">
                <div id="userNameDisplay" style="font-weight:600; font-family: Georgia, serif;">Studente</div>
                <div id="userClassDisplay" style="font-size:0.8rem;opacity:0.8;">Livello CEFR</div>
            </div>
            <button onclick="logout()" style="background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:white;padding:8px 16px;cursor:pointer; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.5px;">Logout</button>
        </div>
    </nav>

    <div class="main-container">
                <aside class="sidebar">
            <div class="menu-category">Generale</div>
            <div class="nav-item active" onclick="showSection('home')" id="nav-home">
                <span>üè†</span><span>Cruscotto</span>
            </div>
            <div class="nav-item" onclick="showSection('results')" id="nav-results">
                <span>üìä</span><span>Registro Valutazioni</span>
            </div>

            <div class="menu-category">GESE - Graded Examinations in Spoken English</div>
            <div class="nav-item" onclick="loadModule('trinity_gese1_intro.html', 'GESE Grade 1')" id="nav-gese1">
                <span>1Ô∏è‚É£</span><span>Grade 1</span><span class="nav-level level-a1">A1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese2_topics.html', 'GESE Grade 2')" id="nav-gese2">
                <span>2Ô∏è‚É£</span><span>Grade 2</span><span class="nav-level level-a1">A1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese3_language.html', 'GESE Grade 3')" id="nav-gese3">
                <span>3Ô∏è‚É£</span><span>Grade 3</span><span class="nav-level level-a2">A2.1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese4_language.html', 'GESE Grade 4')" id="nav-gese4">
                <span>4Ô∏è‚É£</span><span>Grade 4</span><span class="nav-level level-a2">A2.2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese5_language.html', 'GESE Grade 5')" id="nav-gese5">
                <span>5Ô∏è‚É£</span><span>Grade 5</span><span class="nav-level level-b1">B1.1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese6_language.html', 'GESE Grade 6')" id="nav-gese6">
                <span>6Ô∏è‚É£</span><span>Grade 6</span><span class="nav-level level-b1">B1.2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese7_language.html', 'GESE Grade 7')" id="nav-gese7">
                <span>7Ô∏è‚É£</span><span>Grade 7</span><span class="nav-level level-b2">B2.1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese8_language.html', 'GESE Grade 8')" id="nav-gese8">
                <span>8Ô∏è‚É£</span><span>Grade 8</span><span class="nav-level level-b2">B2.2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese9_language.html', 'GESE Grade 9')" id="nav-gese9">
                <span>9Ô∏è‚É£</span><span>Grade 9</span><span class="nav-level level-b2">B2.3</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese10_language.html', 'GESE Grade 10')" id="nav-gese10">
                <span>üîü</span><span>Grade 10</span><span class="nav-level level-c1">C1.1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese11_language.html', 'GESE Grade 11')" id="nav-gese11">
                <span>‚è∏Ô∏è</span><span>Grade 11</span><span class="nav-level level-c1">C1.2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_gese12_language.html', 'GESE Grade 12')" id="nav-gese12">
                <span>üéì</span><span>Grade 12</span><span class="nav-level level-c2">C2</span>
            </div>

            <div class="menu-category">ISE Foundation (A2 - B1)</div>
            <div class="nav-item" onclick="loadModule('trinity_ise_foundation_interview.html', 'ISE Foundation Interview')" id="nav-ise-f-int">
                <span>üé§</span><span>Interview</span><span class="nav-level level-a2">A2-B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise_foundation_portfolio.html', 'ISE Foundation Portfolio')" id="nav-ise-f-port">
                <span>üìÅ</span><span>Portfolio</span><span class="nav-level level-a2">A2-B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise_foundation_task.html', 'ISE Foundation Task')" id="nav-ise-f-task">
                <span>‚úèÔ∏è</span><span>Task</span><span class="nav-level level-a2">A2-B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise_foundation_reading.html', 'ISE Foundation Reading')" id="nav-ise-f-read">
                <span>üìñ</span><span>Reading</span><span class="nav-level level-a2">A2-B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise_foundation_writing.html', 'ISE Foundation Writing')" id="nav-ise-f-write">
                <span>‚úçÔ∏è</span><span>Writing</span><span class="nav-level level-a2">A2-B1</span>
            </div>

            <div class="menu-category">ISE I (B1)</div>
            <div class="nav-item" onclick="loadModule('trinity_ise0_interview.html', 'ISE I Interview')" id="nav-ise1-int">
                <span>üé§</span><span>Interview</span><span class="nav-level level-b1">B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise0_portfolio.html', 'ISE I Portfolio')" id="nav-ise1-port">
                <span>üìÅ</span><span>Portfolio</span><span class="nav-level level-b1">B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise0_task.html', 'ISE I Task')" id="nav-ise1-task">
                <span>‚úèÔ∏è</span><span>Task</span><span class="nav-level level-b1">B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise0_reading.html', 'ISE I Reading')" id="nav-ise1-read">
                <span>üìñ</span><span>Reading</span><span class="nav-level level-b1">B1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise0_writing.html', 'ISE I Writing')" id="nav-ise1-write">
                <span>‚úçÔ∏è</span><span>Writing</span><span class="nav-level level-b1">B1</span>
            </div>

            <div class="menu-category">ISE II (B2)</div>
            <div class="nav-item" onclick="loadModule('trinity_ise1_interview.html', 'ISE II Interview')" id="nav-ise2-int">
                <span>üé§</span><span>Interview</span><span class="nav-level level-b2">B2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise1_portfolio.html', 'ISE II Portfolio')" id="nav-ise2-port">
                <span>üìÅ</span><span>Portfolio</span><span class="nav-level level-b2">B2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise1_task.html', 'ISE II Task')" id="nav-ise2-task">
                <span>‚úèÔ∏è</span><span>Task</span><span class="nav-level level-b2">B2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise1_reading.html', 'ISE II Reading')" id="nav-ise2-read">
                <span>üìñ</span><span>Reading</span><span class="nav-level level-b2">B2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise1_writing.html', 'ISE II Writing')" id="nav-ise2-write">
                <span>‚úçÔ∏è</span><span>Writing</span><span class="nav-level level-b2">B2</span>
            </div>

            <div class="menu-category">ISE III (C1)</div>
            <div class="nav-item" onclick="loadModule('trinity_ise2_interview.html', 'ISE III Interview')" id="nav-ise3-int">
                <span>üé§</span><span>Interview</span><span class="nav-level level-c1">C1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise2_portfolio.html', 'ISE III Portfolio')" id="nav-ise3-port">
                <span>üìÅ</span><span>Portfolio</span><span class="nav-level level-c1">C1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise2_task.html', 'ISE III Task')" id="nav-ise3-task">
                <span>‚úèÔ∏è</span><span>Task</span><span class="nav-level level-c1">C1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise2_reading.html', 'ISE III Reading')" id="nav-ise3-read">
                <span>üìñ</span><span>Reading</span><span class="nav-level level-c1">C1</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise2_writing.html', 'ISE III Writing')" id="nav-ise3-write">
                <span>‚úçÔ∏è</span><span>Writing</span><span class="nav-level level-c1">C1</span>
            </div>

            <div class="menu-category">ISE IV (C2)</div>
            <div class="nav-item" onclick="loadModule('trinity_ise3_interview.html', 'ISE IV Interview')" id="nav-ise4-int">
                <span>üé§</span><span>Interview</span><span class="nav-level level-c2">C2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise3_portfolio.html', 'ISE IV Portfolio')" id="nav-ise4-port">
                <span>üìÅ</span><span>Portfolio</span><span class="nav-level level-c2">C2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise3_task.html', 'ISE IV Task')" id="nav-ise4-task">
                <span>‚úèÔ∏è</span><span>Task</span><span class="nav-level level-c2">C2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise3_reading.html', 'ISE IV Reading')" id="nav-ise4-read">
                <span>üìñ</span><span>Reading</span><span class="nav-level level-c2">C2</span>
            </div>
            <div class="nav-item" onclick="loadModule('trinity_ise3_writing.html', 'ISE IV Writing')" id="nav-ise4-write">
                <span>‚úçÔ∏è</span><span>Writing</span><span class="nav-level level-c2">C2</span>
            </div>

            <div class="menu-category">Simulazioni Esami</div>
            <div class="nav-item" onclick="loadModule('simulazioni.html', 'Simulazioni Esami')" id="nav-simulazioni" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; margin: 8px 12px;">
                <span>üéØ</span><span><strong>SIMULAZIONI ESAMI</strong></span><span style="font-size: 0.6rem; background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 4px;">NEW</span>
            </div>
        </aside>

        <main class="content">
            <!-- HOME -->
            <div id="home" class="section active">
                <div class="breadcrumbs">
                    <strong>Cruscotto - Panoramica Livelli</strong>
                </div>
                <div style="margin-bottom:32px;">
                    <h1 class="section-title">Benvenuto, <span id="welcomeName">Studente</span></h1>
                    <p class="section-subtitle">Seleziona un modulo dalla sidebar per iniziare lo studio</p>
                </div>

                <!-- GESE Descrizioni -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--trinity-red); color: white;">üó£Ô∏è GESE - Graded Examinations in Spoken English</div>
                    <div class="card-body">
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">Esami orali focalizzati sulla comunicazione parlata, dal livello principiante a quello madrelingua.</p>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                            <div style="padding: 16px; background: #f0fdf4; border-left: 4px solid var(--level-a1); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-a1); margin-bottom: 8px;">üå± Grades 1-3 (A1 - A2.1)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);"><strong>Initial Stage:</strong> Presentazioni personali, descrizione di persone e luoghi, routine quotidiane. Focus su vocabolario base e strutture semplici.</p>
                            </div>
                            <div style="padding: 16px; background: #eff6ff; border-left: 4px solid var(--level-a2); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-a2); margin-bottom: 8px;">üåø Grades 4-6 (A2.2 - B1.2)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);"><strong>Elementary Stage:</strong> Narrazione al passato, espressione di opinioni, situazioni ipotetiche. Sviluppo della fluency e accuratezza.</p>
                            </div>
                            <div style="padding: 16px; background: #fef2f2; border-left: 4px solid var(--level-b2); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-b2); margin-bottom: 8px;">üå≥ Grades 7-9 (B2.1 - B2.3)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);"><strong>Intermediate Stage:</strong> Analisi critica, argomentazione complessa, temi astratti. Capacit√† di negoziare significato.</p>
                            </div>
                            <div style="padding: 16px; background: #faf5ff; border-left: 4px solid var(--level-c1); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-c1); margin-bottom: 8px;">üèÜ Grades 10-12 (C1 - C2)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);"><strong>Advanced Stage:</strong> Discorso accademico, ricerca indipendente, competenza pragmatica. Livello professionale/madrelingua.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ISE Descrizioni -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--trinity-blue); color: white;">üìö ISE - Integrated Skills in English</div>
                    <div class="card-body">
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">Esami integrati che valutano lettura, scrittura, ascolto e produzione orale attraverso task autentici.</p>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            <div style="padding: 16px; background: #eff6ff; border-left: 4px solid #2563eb; border-radius: 0 8px 8px 0;">
                                <h4 style="color: #2563eb; margin-bottom: 8px;">üìò ISE Foundation (A2-B1)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Comprensione di testi semplici, scrittura di email e brevi testi, conversazioni quotidiane.</p>
                            </div>
                            <div style="padding: 16px; background: #fefce8; border-left: 4px solid #c9a227; border-radius: 0 8px 8px 0;">
                                <h4 style="color: #c9a227; margin-bottom: 8px;">üìó ISE I (B1)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Lettura di articoli, scrittura di saggi brevi, espressione di opinioni, task integrati.</p>
                            </div>
                            <div style="padding: 16px; background: #fef2f2; border-left: 4px solid var(--level-b2); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-b2); margin-bottom: 8px;">üìï ISE II (B2)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Testi complessi, scrittura argomentativa, analisi critica, presentazioni strutturate.</p>
                            </div>
                            <div style="padding: 16px; background: #faf5ff; border-left: 4px solid var(--level-c1); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-c1); margin-bottom: 8px;">üìô ISE III (C1)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Letteratura specialistica, scrittura accademica, inferenze complesse, fluency elevata.</p>
                            </div>
                            <div style="padding: 16px; background: #f1f5f9; border-left: 4px solid var(--level-c2); border-radius: 0 8px 8px 0;">
                                <h4 style="color: var(--level-c2); margin-bottom: 8px;">üìì ISE IV (C2)</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Livello madrelingua, manipolazione sofisticata del linguaggio, consapevolezza pragmatica.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Istruzioni -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; text-align: center;">
                    <h3 style="margin-bottom: 12px;">üéØ Come Iniziare</h3>
                    <p>Utilizza la sidebar a sinistra per navigare tra i moduli. Ogni sezione contiene materiali didattici specifici per il tuo livello di preparazione.</p>
                </div>
            </div>

                <div id="dashboard-gese-initial" class="level-dashboard">
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px;">
                        <div class="stat-card">
                            <div class="stat-label">Grades Completati</div>
                            <div class="stat-value" id="statTotalGeseInitial">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Media Stage</div>
                            <div class="stat-value" id="statAvgGeseInitial">0%</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" style="background: var(--level-a1); color: white;">GESE Initial Stage - Grades 1-3</div>
                        <div class="card-body">
                            <div class="games-grid">
                                <a href="#" onclick="loadModule('trinity_gese1_intro.html', 'GESE Grade 1'); return false;" class="game-card">
                                    <span class="game-level-badge level-a1">Grade 1</span>
                                    <div class="game-image bg-a1">üéØ</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 1: Introduction</div>
                                        <p class="game-desc">Basic introductions, giving personal information, numbers 1-20, colours.</p>
                                        <div class="exam-info">CEFR: A1 | Durata: 5 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese2_topics.html', 'GESE Grade 2'); return false;" class="game-card">
                                    <span class="game-level-badge level-a1">Grade 2</span>
                                    <div class="game-image bg-a1">üí¨</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 2: Topics</div>
                                        <p class="game-desc">Talking about topics, asking questions, describing people and places.</p>
                                        <div class="exam-info">CEFR: A1 | Durata: 6 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese3_language.html', 'GESE Grade 3'); return false;" class="game-card">
                                    <span class="game-level-badge level-a2">Grade 3</span>
                                    <div class="game-image bg-a2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 3: Language</div>
                                        <p class="game-desc">Past simple, future forms, giving reasons, expressing preferences.</p>
                                        <div class="exam-info">CEFR: A2.1 | Durata: 7 min</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dashboard-gese-elementary" class="level-dashboard" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="background: var(--level-a2); color: white;">GESE Elementary Stage - Grades 4-6</div>
                        <div class="card-body">
                            <div class="games-grid">
                                <a href="#" onclick="loadModule('trinity_gese4_language.html', 'GESE Grade 4'); return false;" class="game-card">
                                    <span class="game-level-badge level-a2">Grade 4</span>
                                    <div class="game-image bg-a2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 4</div>
                                        <p class="game-desc">Extended discourse, narrative tenses, expressing opinions.</p>
                                        <div class="exam-info">CEFR: A2.2 | Durata: 10 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese5_language.html', 'GESE Grade 5'); return false;" class="game-card">
                                    <span class="game-level-badge level-b1">Grade 5</span>
                                    <div class="game-image bg-b1">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 5</div>
                                        <p class="game-desc">Conditional forms, modal verbs, argumentation skills.</p>
                                        <div class="exam-info">CEFR: B1.1 | Durata: 10 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese6_language.html', 'GESE Grade 6'); return false;" class="game-card">
                                    <span class="game-level-badge level-b1">Grade 6</span>
                                    <div class="game-image bg-b1">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 6</div>
                                        <p class="game-desc">Complex structures, reasoning, hypothetical situations.</p>
                                        <div class="exam-info">CEFR: B1.2 | Durata: 10 min</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dashboard-gese-intermediate" class="level-dashboard" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="background: var(--level-b2); color: white;">GESE Intermediate Stage - Grades 7-9</div>
                        <div class="card-body">
                            <div class="games-grid">
                                <a href="#" onclick="loadModule('trinity_gese7_language.html', 'GESE Grade 7'); return false;" class="game-card">
                                    <span class="game-level-badge level-b2">Grade 7</span>
                                    <div class="game-image bg-b2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 7</div>
                                        <p class="game-desc">Multiple perspectives, speculation, abstract topics.</p>
                                        <div class="exam-info">CEFR: B2.1 | Durata: 15 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese8_language.html', 'GESE Grade 8'); return false;" class="game-card">
                                    <span class="game-level-badge level-b2">Grade 8</span>
                                    <div class="game-image bg-b2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 8</div>
                                        <p class="game-desc">Critical analysis, inference, nuanced expression.</p>
                                        <div class="exam-info">CEFR: B2.2 | Durata: 15 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese9_language.html', 'GESE Grade 9'); return false;" class="game-card">
                                    <span class="game-level-badge level-b2">Grade 9</span>
                                    <div class="game-image bg-b2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 9</div>
                                        <p class="game-desc">Synthesis of ideas, complex argumentation, fluency.</p>
                                        <div class="exam-info">CEFR: B2.3 | Durata: 15 min</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dashboard-gese-advanced" class="level-dashboard" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="background: var(--level-c1); color: white;">GESE Advanced Stage - Grades 10-12</div>
                        <div class="card-body">
                            <div class="games-grid">
                                <a href="#" onclick="loadModule('trinity_gese10_language.html', 'GESE Grade 10'); return false;" class="game-card">
                                    <span class="game-level-badge level-c1">Grade 10</span>
                                    <div class="game-image bg-c1">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 10</div>
                                        <p class="game-desc">Evaluation, sophisticated vocabulary, cultural awareness.</p>
                                        <div class="exam-info">CEFR: C1.1 | Durata: 25 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese11_language.html', 'GESE Grade 11'); return false;" class="game-card">
                                    <span class="game-level-badge level-c1">Grade 11</span>
                                    <div class="game-image bg-c1">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 11</div>
                                        <p class="game-desc">Research presentation, critical evaluation, discourse management.</p>
                                        <div class="exam-info">CEFR: C1.2 | Durata: 25 min</div>
                                    </div>
                                </a>
                                <a href="#" onclick="loadModule('trinity_gese12_language.html', 'GESE Grade 12'); return false;" class="game-card">
                                    <span class="game-level-badge level-c2">Grade 12</span>
                                    <div class="game-image bg-c2">üó£Ô∏è</div>
                                    <div class="game-content">
                                        <div class="game-title">GESE Grade 12</div>
                                        <p class="game-desc">Mastery level, academic discourse, complex negotiation.</p>
                                        <div class="exam-info">CEFR: C2 | Durata: 25 min</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- IFRAME SECTION -->
            <div id="module-frame" class="section">
                <div class="breadcrumbs" id="module-breadcrumbs">
                    <span onclick="showSection('home')" style="cursor: pointer;">Home</span> / 
                    <strong id="current-module-name">Modulo</strong>
                </div>
                <div class="iframe-container">
                    <iframe name="contentFrame" class="content-iframe" src="about:blank"></iframe>
                </div>
            </div>

            <!-- RESULTS -->
            <div id="results" class="section">
                <div class="breadcrumbs">
                    <span onclick="showSection('home')" style="cursor: pointer;">Home</span> / <strong>Registro Valutazioni</strong>
                </div>
                <div style="margin:24px 0;">
                    <h1 class="section-title">Registro Valutazioni</h1>
                    <p class="section-subtitle">Riepilogo completo dei punteggi e del progresso formativo su tutti i livelli</p>
                </div>

                <!-- Statistiche Generali -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-label">Moduli Completati</div>
                        <div class="stat-value" id="statCompleted">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Media Generale</div>
                        <div class="stat-value" id="statAverage">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Livello Pi√π Alto</div>
                        <div class="stat-value" id="statHighest">-</div>
                    </div>
                </div>

                <!-- GESE Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--trinity-red); color: white;">üó£Ô∏è GESE - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="geseTable">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Grade</th>
                                    <th style="text-align: center; padding: 12px;">Livello CEFR</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="geseResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ISE Foundation Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: #2563eb; color: white;">üìö ISE Foundation - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="iseFTable">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Modulo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="iseFResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ISE I Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: #c9a227; color: #000;">üìó ISE I (B1) - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="ise1Table">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Modulo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="ise1ResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ISE II Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--level-b2); color: white;">üìï ISE II (B2) - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="ise2Table">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Modulo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="ise2ResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ISE III Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--level-c1); color: white;">üìô ISE III (C1) - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="ise3Table">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Modulo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="ise3ResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ISE IV Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: var(--level-c2); color: white;">üìì ISE IV (C2) - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="ise4Table">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Modulo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="ise4ResultsBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Simulazioni Results -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">üéØ Simulazioni Esami - Risultati</div>
                    <div class="card-body">
                        <table style="width: 100%; border-collapse: collapse;" id="simTable">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--border);">
                                    <th style="text-align: left; padding: 12px;">Simulazione</th>
                                    <th style="text-align: center; padding: 12px;">Tipo</th>
                                    <th style="text-align: center; padding: 12px;">Data</th>
                                    <th style="text-align: center; padding: 12px;">Punteggio</th>
                                    <th style="text-align: center; padding: 12px;">Stato</th>
                                </tr>
                            </thead>
                            <tbody id="simResultsBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
// Database unificato
let db = { users: [], requests: [], scores: [] };
let currentUser = null;

// Inizializzazione
document.addEventListener('DOMContentLoaded', function() {
    initDB();

    // Check sessione
    const studentSession = sessionStorage.getItem('studentLoggedIn');
    if (studentSession === 'true') {
        const email = sessionStorage.getItem('studentEmail');
        currentUser = db.users.find(u => u.email === email);
        if (currentUser) {
            showDashboard();
        }
    }
});

function initDB() {
    const stored = localStorage.getItem('accademia_data');
    if (stored) {
        db = JSON.parse(stored);
        if (!db.users) db.users = [];
        if (!db.requests) db.requests = [];
        if (!db.scores) db.scores = [];
    }
}

function saveDB() {
    localStorage.setItem('accademia_data', JSON.stringify(db));
}

// Login
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    const user = db.users.find(u => u.email === email && u.password === password && u.role === 'student');

    if (!user) {
        showAlert('Credenziali non valide');
        return;
    }

    // Verifica dispositivo (solo 1 consentito)
    const deviceId = getDeviceId();

    if (user.firstLogin === true) {
        // Primo login - redirect a cambio password
        sessionStorage.setItem('studentLoggedIn', 'true');
        sessionStorage.setItem('studentEmail', email);
        sessionStorage.setItem('firstLogin', 'true');
        window.location.href = 'cambio-password.html';
        return;
    }

    // Verifica dispositivo registrato
    if (!user.devices || user.devices.length === 0 || user.devices[0].id !== deviceId) {
        showAlert('Dispositivo non autorizzato. Contatta l\'amministratore.');
        return;
    }

    // Login ok
    currentUser = user;
    sessionStorage.setItem('studentLoggedIn', 'true');
    sessionStorage.setItem('studentEmail', email);

    showDashboard();
});

function getDeviceId() {
    let deviceId = localStorage.getItem('accademia_device_id');
    if (!deviceId) {
        deviceId = 'dev_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('accademia_device_id', deviceId);
    }
    return deviceId;
}

function showDashboard() {
    document.getElementById('loginSection').classList.remove('active');
    document.getElementById('dashboard').style.display = 'flex';

    const displayName = currentUser ? (currentUser.name || currentUser.email) : 'Studente';
    document.getElementById('welcomeName').textContent = displayName;
    document.getElementById('userNameDisplay').textContent = displayName;

    // Determina livello da password (legacy) o default
    let level = 'A1';
    if (currentUser && currentUser.password) {
        if (currentUser.password.includes('C2')) level = 'C2';
        else if (currentUser.password.includes('C1')) level = 'C1';
        else if (currentUser.password.includes('B2')) level = 'B2';
        else if (currentUser.password.includes('B1')) level = 'B1';
        else if (currentUser.password.includes('A2')) level = 'A2';
    }
    document.getElementById('userClassDisplay').textContent = 'Livello ' + level + ' CEFR';

    loadResults();
}

function logout() {
    sessionStorage.removeItem('studentLoggedIn');
    sessionStorage.removeItem('studentEmail');
    currentUser = null;
    window.location.reload();
}

function showAlert(message) {
    const alert = document.getElementById('alertBox');
    alert.textContent = message;
    alert.style.display = 'block';
    setTimeout(() => alert.style.display = 'none', 5000);
}

// Navigazione
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');

    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const navItem = document.getElementById('nav-' + sectionId);
    if (navItem) navItem.classList.add('active');
}

function loadModule(url, name) {
    showSection('module-frame');
    document.getElementById('current-module-name').textContent = name;
    document.querySelector('iframe[name="contentFrame"]').src = url;
}

function showExamType(type) {
    // Toggle tabs
    document.querySelectorAll('.exam-tab').forEach(t => t.classList.remove('active'));
    event.currentTarget.classList.add('active');

    // Qui si potrebbero mostrare/nascondere i vari livelli
}

function showLevel(level) {
    // Mostra/nasconde i dashboard dei livelli
    document.querySelectorAll('.level-dashboard').forEach(d => d.style.display = 'none');
    const target = document.getElementById('dashboard-' + level);
    if (target) target.style.display = 'block';

    // Aggiorna active state
    document.querySelectorAll('.level-card').forEach(c => c.classList.remove('active'));
    if (event && event.currentTarget) event.currentTarget.classList.add('active');
}

// Struttura dati per tutti i moduli
const allModules = {
    gese: [
        { grade: 1, name: 'GESE Grade 1', level: 'A1', levelClass: 'level-a1' },
        { grade: 2, name: 'GESE Grade 2', level: 'A1', levelClass: 'level-a1' },
        { grade: 3, name: 'GESE Grade 3', level: 'A2.1', levelClass: 'level-a2' },
        { grade: 4, name: 'GESE Grade 4', level: 'A2.2', levelClass: 'level-a2' },
        { grade: 5, name: 'GESE Grade 5', level: 'B1.1', levelClass: 'level-b1' },
        { grade: 6, name: 'GESE Grade 6', level: 'B1.2', levelClass: 'level-b1' },
        { grade: 7, name: 'GESE Grade 7', level: 'B2.1', levelClass: 'level-b2' },
        { grade: 8, name: 'GESE Grade 8', level: 'B2.2', levelClass: 'level-b2' },
        { grade: 9, name: 'GESE Grade 9', level: 'B2.3', levelClass: 'level-b2' },
        { grade: 10, name: 'GESE Grade 10', level: 'C1.1', levelClass: 'level-c1' },
        { grade: 11, name: 'GESE Grade 11', level: 'C1.2', levelClass: 'level-c1' },
        { grade: 12, name: 'GESE Grade 12', level: 'C2', levelClass: 'level-c2' }
    ],
    iseF: [
        { name: 'Interview', icon: 'üé§' },
        { name: 'Portfolio', icon: 'üìÅ' },
        { name: 'Task', icon: '‚úèÔ∏è' },
        { name: 'Reading', icon: 'üìñ' },
        { name: 'Writing', icon: '‚úçÔ∏è' }
    ],
    ise1: [
        { name: 'Interview', icon: 'üé§' },
        { name: 'Portfolio', icon: 'üìÅ' },
        { name: 'Task', icon: '‚úèÔ∏è' },
        { name: 'Reading', icon: 'üìñ' },
        { name: 'Writing', icon: '‚úçÔ∏è' }
    ],
    ise2: [
        { name: 'Interview', icon: 'üé§' },
        { name: 'Portfolio', icon: 'üìÅ' },
        { name: 'Task', icon: '‚úèÔ∏è' },
        { name: 'Reading', icon: 'üìñ' },
        { name: 'Writing', icon: '‚úçÔ∏è' }
    ],
    ise3: [
        { name: 'Interview', icon: 'üé§' },
        { name: 'Portfolio', icon: 'üìÅ' },
        { name: 'Task', icon: '‚úèÔ∏è' },
        { name: 'Reading', icon: 'üìñ' },
        { name: 'Writing', icon: '‚úçÔ∏è' }
    ],
    ise4: [
        { name: 'Interview', icon: 'üé§' },
        { name: 'Portfolio', icon: 'üìÅ' },
        { name: 'Task', icon: '‚úèÔ∏è' },
        { name: 'Reading', icon: 'üìñ' },
        { name: 'Writing', icon: '‚úçÔ∏è' }
    ],
    simulazioni: [
        { name: 'GESE 1', type: 'GESE', level: 'A1' },
        { name: 'GESE 2', type: 'GESE', level: 'A1' },
        { name: 'GESE 3', type: 'GESE', level: 'A2.1' },
        { name: 'GESE 4', type: 'GESE', level: 'A2.2' },
        { name: 'GESE 5', type: 'GESE', level: 'B1.1' },
        { name: 'GESE 6', type: 'GESE', level: 'B1.2' },
        { name: 'GESE 7', type: 'GESE', level: 'B2.1' },
        { name: 'GESE 8', type: 'GESE', level: 'B2.2' },
        { name: 'GESE 9', type: 'GESE', level: 'B2.3' },
        { name: 'GESE 10', type: 'GESE', level: 'C1.1' },
        { name: 'GESE 11', type: 'GESE', level: 'C1.2' },
        { name: 'GESE 12', type: 'GESE', level: 'C2' },
        { name: 'ISE Foundation', type: 'ISE-F', level: 'A2-B1' },
        { name: 'ISE I', type: 'ISE-I', level: 'B1' },
        { name: 'ISE II', type: 'ISE-II', level: 'B2' },
        { name: 'ISE III', type: 'ISE-III', level: 'C1' },
        { name: 'ISE IV', type: 'ISE-IV', level: 'C2' }
    ]
};

// Funzione per salvare un risultato
function saveResult(moduleName, score, status) {
    if (!currentUser) return;

    const result = {
        module: moduleName,
        score: score,
        status: status,
        date: new Date().toLocaleDateString('it-IT'),
        timestamp: new Date().toISOString()
    };

    // Inizializza scores se non esiste
    if (!db.scores) db.scores = [];

    // Cerca se esiste gi√† un risultato per questo modulo e utente
    const existingIndex = db.scores.findIndex(s => 
        s.userEmail === currentUser.email && s.module === moduleName
    );

    if (existingIndex >= 0) {
        // Aggiorna risultato esistente
        db.scores[existingIndex] = { ...result, userEmail: currentUser.email };
    } else {
        // Aggiungi nuovo risultato
        db.scores.push({ ...result, userEmail: currentUser.email });
    }

    saveDB();
    loadResults(); // Ricarica la visualizzazione
}

// Funzione per ottenere risultati dell'utente corrente
function getUserResults() {
    if (!currentUser || !db.scores) return [];
    return db.scores.filter(s => s.userEmail === currentUser.email);
}

function loadResults() {
    const userResults = getUserResults();

    // GESE Results
    const geseBody = document.getElementById('geseResultsBody');
    if (geseBody) {
        geseBody.innerHTML = allModules.gese.map(g => {
            const result = userResults.find(r => r.module === g.name);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${g.name}</td>
                    <td style="padding: 12px; text-align: center;"><span class="nav-level ${g.levelClass}">${g.level}</span></td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ISE Foundation Results
    const iseFBody = document.getElementById('iseFResultsBody');
    if (iseFBody) {
        iseFBody.innerHTML = allModules.iseF.map(m => {
            const result = userResults.find(r => r.module === `ISE Foundation ${m.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${m.icon} ${m.name}</td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ISE I Results
    const ise1Body = document.getElementById('ise1ResultsBody');
    if (ise1Body) {
        ise1Body.innerHTML = allModules.ise1.map(m => {
            const result = userResults.find(r => r.module === `ISE I ${m.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${m.icon} ${m.name}</td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ISE II Results
    const ise2Body = document.getElementById('ise2ResultsBody');
    if (ise2Body) {
        ise2Body.innerHTML = allModules.ise2.map(m => {
            const result = userResults.find(r => r.module === `ISE II ${m.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${m.icon} ${m.name}</td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ISE III Results
    const ise3Body = document.getElementById('ise3ResultsBody');
    if (ise3Body) {
        ise3Body.innerHTML = allModules.ise3.map(m => {
            const result = userResults.find(r => r.module === `ISE III ${m.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${m.icon} ${m.name}</td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ISE IV Results
    const ise4Body = document.getElementById('ise4ResultsBody');
    if (ise4Body) {
        ise4Body.innerHTML = allModules.ise4.map(m => {
            const result = userResults.find(r => r.module === `ISE IV ${m.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">${m.icon} ${m.name}</td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // Simulazioni Results
    const simBody = document.getElementById('simResultsBody');
    if (simBody) {
        simBody.innerHTML = allModules.simulazioni.map(s => {
            const result = userResults.find(r => r.module === `Simulazione ${s.name}`);
            return `
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 12px;">üéØ Simulazione ${s.name}</td>
                    <td style="padding: 12px; text-align: center;"><span class="nav-level level-${s.level.toLowerCase().replace('.', '')}">${s.type}</span></td>
                    <td style="padding: 12px; text-align: center; color: var(--text-secondary);">${result ? result.date : '-'}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 600;">${result ? result.score + '%' : '-'}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span class="status-badge ${result ? (result.status === 'Completato' ? 'status-completed' : 'status-pending') : 'status-pending'}">
                            ${result ? result.status : 'Da iniziare'}
                        </span>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // Aggiorna statistiche
    updateStats(userResults);
}

function updateStats(userResults) {
    const completed = userResults.filter(r => r.status === 'Completato').length;
    const total = userResults.length;
    const average = total > 0 ? Math.round(userResults.reduce((sum, r) => sum + parseInt(r.score), 0) / total) : 0;

    // Trova livello pi√π alto completato
    const levels = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
    let highest = '-';
    for (let i = levels.length - 1; i >= 0; i--) {
        if (userResults.some(r => r.module.includes(levels[i]) && r.status === 'Completato')) {
            highest = levels[i];
            break;
        }
    }

    document.getElementById('statCompleted').textContent = completed;
    document.getElementById('statAverage').textContent = average + '%';
    document.getElementById('statHighest').textContent = highest;
}
</script>

</body>
</html>
